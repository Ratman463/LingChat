import{d as V,p as oe,q as W,r as y,s as O,v as M,c as _,j as F,b as a,n as Y,h as b,x as se,_ as R,o as J,y as pe,F as D,m as K,t as C,i as j,e as L,z as $,k as l,A as ae,B as $e,C as ye,D as H,E as de,G as _e,f as h,H as ke,I as fe,J as Se,K as xe,L as ge,M as q,w as m,N as Q,O as me,l as ve,P as te}from"./index-CNp4m9Xz.js";import{S as Ae,_ as Be}from"./StarField-jY5xdywl.js";const be="/api/v1",U={AVATAR:{BASE:`${be}/chat/character/get_avatar`},VOICE:{BASE:`${be}/chat/sound/get_voice`}},Ie={åŒæ¶:"åŒæ¶",é«˜å…´:"é«˜å…´",æ‹…å¿ƒ:"æ‹…å¿ƒ",ç”Ÿæ°”:"ç”Ÿæ°”",ç´§å¼ :"ç´§å¼ ",å®³æ€•:"å®³æ€•",å®³ç¾:"å®³ç¾",æ…Œå¼ :"æ…Œå¼ ",è®¤çœŸ:"è®¤çœŸ",æ— å¥ˆ:"æ— å¥ˆ",å…´å¥‹:"å…´å¥‹",ç–‘æƒ‘:"ç–‘æƒ‘",å“­æ³£:"ä¼¤å¿ƒ",å¿ƒåŠ¨:"å¿ƒåŠ¨",è°ƒçš®:"è°ƒçš®",éš¾ä¸ºæƒ…:"ç¾è€»",è‡ªä¿¡:"è‡ªä¿¡",æƒŠè®¶:"æƒŠè®¶",æ­£å¸¸:"æ­£å¸¸",AIæ€è€ƒ:"none"},he={åŒæ¶:{animation:"none",bubbleImage:"../pictures/animation/ç”Ÿæ°”.webp",bubbleClass:"angry",audio:"../audio_effects/åŒæ¶.wav",avatar:`${U.AVATAR.BASE}/åŒæ¶.png`},é«˜å…´:{animation:"happy-bounce",bubbleImage:"../pictures/animation/é«˜å…´.webp",bubbleClass:"happy",audio:"../audio_effects/å–œæ‚¦.wav",avatar:`${U.AVATAR.BASE}/é«˜å…´.png`},æ‹…å¿ƒ:{animation:"none",bubbleImage:"../pictures/animation/æµæ³ª.webp",bubbleClass:"none",audio:"../audio_effects/ä¼¤å¿ƒ.wav",avatar:`${U.AVATAR.BASE}/æ‹…å¿ƒ.png`},ç”Ÿæ°”:{animation:"angry-jump",bubbleImage:"../pictures/animation/ç”Ÿæ°”2.webp",bubbleClass:"angry",audio:"../audio_effects/ç”Ÿæ°”.wav",avatar:`${U.AVATAR.BASE}/ç”Ÿæ°”.png`},ç´§å¼ :{animation:"none",bubbleImage:"../pictures/animation/ç´§å¼ .webp",bubbleClass:"none",audio:"../audio_effects/å°´å°¬.wav",avatar:`${U.AVATAR.BASE}/ç´§å¼ .png`},å®³æ€•:{animation:"none",bubbleImage:"../pictures/animation/æƒŠè®¶.webp",bubbleClass:"none",audio:"../audio_effects/éœ‡æƒŠ.wav",avatar:`${U.AVATAR.BASE}/å®³æ€•.png`},å®³ç¾:{animation:"none",bubbleImage:"../pictures/animation/å®³ç¾.webp",bubbleClass:"shy",audio:"../audio_effects/å®³ç¾.wav",avatar:`${U.AVATAR.BASE}/å®³ç¾.png`},æ…Œå¼ :{animation:"none",bubbleImage:"../pictures/animation/æ…Œä¹±.webp",bubbleClass:"none",audio:"../audio_effects/éœ‡æƒŠ.wav",avatar:`${U.AVATAR.BASE}/æ…Œå¼ .png`},è®¤çœŸ:{animation:"serious-think",bubbleImage:"none",bubbleClass:"none",audio:"none",avatar:`${U.AVATAR.BASE}/è®¤çœŸ.png`},æ— å¥ˆ:{animation:"none",bubbleImage:"../pictures/animation/å¹æ°”.webp",bubbleClass:"none",audio:"../audio_effects/å¹æ°”.wav",avatar:`${U.AVATAR.BASE}/æ— å¥ˆ.png`},å…´å¥‹:{animation:"happy-bounce",bubbleImage:"../pictures/animation/èŠå¤©.webp",bubbleClass:"none",audio:"../audio_effects/èŠå¤©.wav",avatar:`${U.AVATAR.BASE}/å…´å¥‹.png`},ç–‘æƒ‘:{animation:"none",bubbleImage:"../pictures/animation/ç–‘é—®.webp",bubbleClass:"none",audio:"../audio_effects/ç–‘é—®.wav",avatar:`${U.AVATAR.BASE}/ç–‘æƒ‘.png`},å“­æ³£:{animation:"none",bubbleImage:"../pictures/animation/æµæ³ª.webp",bubbleClass:"none",audio:"../audio_effects/ä¼¤å¿ƒ.wav",avatar:`${U.AVATAR.BASE}/ä¼¤å¿ƒ.png`},å¿ƒåŠ¨:{animation:"heart-beat",bubbleImage:"../pictures/animation/å¿ƒåŠ¨.webp",bubbleClass:"none",audio:"../audio_effects/å–œçˆ±.wav",avatar:`${U.AVATAR.BASE}/å¿ƒåŠ¨.png`},è°ƒçš®:{animation:"naughty-bounce",bubbleImage:"../pictures/animation/é«˜å…´.webp",bubbleClass:"none",audio:"../audio_effects/æ„‰å¿«.wav",avatar:`${U.AVATAR.BASE}/è°ƒçš®.png`},éš¾ä¸ºæƒ…:{animation:"embarrassed-emo",bubbleImage:"../pictures/animation/éš¾ä¸ºæƒ….webp",bubbleClass:"none",audio:"../audio_effects/å¯Ÿè§‰.wav",avatar:`${U.AVATAR.BASE}/ç¾è€».png`},è‡ªä¿¡:{animation:"none",bubbleImage:"../pictures/animation/é«˜å…´.webp",bubbleClass:"none",audio:"../audio_effects/æ„‰å¿«.wav",avatar:`${U.AVATAR.BASE}/è‡ªä¿¡.png`},æƒŠè®¶:{animation:"none",bubbleImage:"../pictures/animation/æƒŠè®¶.webp",bubbleClass:"none",audio:"../audio_effects/å¯Ÿè§‰.wav",avatar:`${U.AVATAR.BASE}/æƒŠè®¶.png`},æ­£å¸¸:{animation:"none",bubbleImage:"none",bubbleClass:"none",audio:"none",avatar:`${U.AVATAR.BASE}/æ­£å¸¸.png`},AIæ€è€ƒ:{animation:"none",bubbleImage:"../pictures/animation/AIæ€è€ƒ.webp",bubbleClass:"none",audio:"../audio_effects/æ— è¯­.wav",avatar:"none"}},Me=V({__name:"GameAvatar",emits:["audio-ended"],setup(n,{expose:e,emit:r}){const o=oe(),t=W(),u=r,c=y(null),d=y(null),k=y("normalx"),w=y(""),S=y(!1),x=y(""),f=y(""),i=O(()=>{const E=o.character,z=o.avatar.emotion,X=he[z]||he.æ­£å¸¸;return z==="AIæ€è€ƒ"?"none":o.script.isRunning?`/api/v1/chat/character/get_script_avatar/${E}/${Ie[z]}`:`${X.avatar}`}),s=O(()=>({[k.value]:!0,"avatar-visible":o.avatar.show,"avatar-hidden":!o.avatar.show})),p=O(()=>({backgroundImage:`url(${w.value})`,top:`${o.avatar.offset_y}px`,transform:`scale(${o.avatar.scale})`})),g=O(()=>({show:S.value,[f.value]:S.value&&f.value})),v=O(()=>({left:`${o.avatar.bubble_left}%`,top:`${o.avatar.bubble_top}%`,backgroundImage:`url(${x.value})`})),P=E=>{if(!E||E==="none")return;const z=Date.now(),X=`${E}?t=${z}`,le=new Image;le.onload=()=>{w.value=X},le.onerror=()=>{console.error(`åŠ è½½å¤´åƒå¤±è´¥: ${X}`),w.value="/api/v1/chat/character/get_avatar/æ­£å¸¸.png"},le.src=X};M(i,E=>{P(E)},{immediate:!0}),M(()=>o.avatar.character_id,E=>{P(i.value)}),M(()=>o.avatar.emotion,E=>{const z=he[E];if(z){if(z.animation&&z.animation!=="none"&&(k.value=z.animation),z.bubbleImage&&z.bubbleImage!=="none"){const X=Date.now();x.value=`${z.bubbleImage}?t=${X}#t=0.1`,f.value=z.bubbleClass,S.value=!1,se(()=>{S.value=!0}),setTimeout(()=>{S.value=!1},2e3)}z.audio&&z.audio!=="none"&&d.value&&(d.value.src=z.audio,d.value.load(),d.value.play())}},{immediate:!0}),M(()=>t.currentAvatarAudio,E=>{c.value&&E&&E!=="None"&&(c.value.src=`${U.VOICE.BASE}/${E}`,c.value.load(),c.value.play())}),M(()=>t.characterVolume,E=>{c.value&&(c.value.volume=E/100)}),M(()=>t.bubbleVolume,E=>{d.value&&(d.value.volume=E/100)});const N=()=>{u("audio-ended")},ee=()=>{k.value!=="normal"&&(k.value="normal")};return e({setEmotion:E=>{o.avatar.emotion=E}}),(E,z)=>(b(),_("div",{class:F([s.value,"avatar-container character-animation normal"]),onAnimationend:ee},[a("div",{style:Y(p.value),class:"avatar-img",id:"qinling"},null,4),a("div",{class:F([g.value,"bubble"]),style:Y(v.value)},null,6),a("audio",{ref_key:"avatarAudio",ref:c,onEnded:N},null,544),a("audio",{ref_key:"bubbleAudio",ref:d},null,512)],34))}}),Te={__name:"Rain",props:{enabled:{type:Boolean,default:!0},intensity:{type:Number,default:1,validator:n=>n>=0&&n<=2}},setup(n){const e=n,r=y(50),o=y(20),t=y([]),u=y(null),c=y(null),d=y(0),k=y(null);M(()=>e.intensity,f=>{r.value=Math.max(10,100-f*45)},{immediate:!0});const w=()=>{e.enabled&&(clearInterval(u.value),u.value=setInterval(()=>{const f={top:-100,left:`${~~(Math.random()*100)}%`,speed:10+Math.random()*10*e.intensity,size:30+Math.random()*40*e.intensity,opacity:.2+Math.random()*.5};t.value.push(f)},r.value))},S=()=>{e.enabled&&(clearInterval(c.value),c.value=setInterval(()=>{const f=t.value.filter(i=>i.top<d.value);f.forEach(i=>{i.top+=i.speed}),t.value=f},o.value))},x=()=>{k.value&&k.value.parentElement?d.value=k.value.parentElement.clientHeight:d.value=window.innerHeight};return J(()=>{se(()=>{x(),e.enabled&&(w(),S())}),window.addEventListener("resize",x)}),pe(()=>{clearInterval(u.value),clearInterval(c.value),window.removeEventListener("resize",x)}),M(()=>e.enabled,f=>{f?(x(),w(),S()):(clearInterval(u.value),clearInterval(c.value),t.value=[])}),(f,i)=>(b(),_("div",{class:"rain-container",ref_key:"containerRef",ref:k},[(b(!0),_(D,null,K(t.value,(s,p)=>(b(),_("span",{class:"rain-item",key:p,style:Y({top:`${s.top}px`,left:s.left,height:`${s.size}px`,opacity:s.opacity})},null,4))),128))],512))}},Ee=R(Te,[["__scopeId","data-v-76d838e4"]]),Re=V({__name:"Sakura",props:{enabled:{type:Boolean,default:!0},intensity:{default:1}},setup(n){const e=n,r=y([]),o=y(null),t=y(0),u=y(Math.floor(25*e.intensity)),c=()=>Math.random().toString(36).substr(2,9),d=()=>{const i=Math.random()*10+10,s=Math.random()*window.innerWidth,p=-30,g=Math.random()*10+15,v=Math.random()*10,P=Math.random()*.5+.4,N=Math.random()*10+320,ee=Math.random()*100-50;return{id:c(),size:i,left:s,top:p,opacity:P,hue:N,duration:g,delay:v,horizontalMovement:ee}},k=i=>{const s=document.createElement("style");document.head.appendChild(s);const p=`
  @keyframes fall-${i.id} {
    0% {
      transform: translate(0, 0) rotate(0deg);
      opacity: ${i.opacity};
    }
    25% {
      transform: translate(${i.horizontalMovement*.25}px, ${t.value*.25}px) 
                 rotate(${90+Math.random()*90}deg);
      opacity: ${i.opacity*.9};
    }
    50% {
      transform: translate(${i.horizontalMovement*.5}px, ${t.value*.5}px) 
                 rotate(${180+Math.random()*90}deg);
      opacity: ${i.opacity*.7};
    }
    75% {
      transform: translate(${i.horizontalMovement*.75}px, ${t.value*.75}px) 
                 rotate(${270+Math.random()*90}deg);
      opacity: ${i.opacity*.5};
    }
    100% {
      transform: translate(${i.horizontalMovement}px, ${t.value}px) 
                 rotate(${360+Math.random()*180}deg);
      opacity: 0;
    }
  }
`;s.innerHTML=p,i.styleSheet=s},w=i=>{for(let s=0;s<i;s++){const p=d();k(p),r.value.push(p)}},S=()=>{r.value.forEach(i=>{i.styleSheet&&i.styleSheet.parentNode&&i.styleSheet.parentNode.removeChild(i.styleSheet)}),r.value=[]},x=()=>{o.value&&o.value.parentElement?t.value=o.value.parentElement.clientHeight:t.value=window.innerHeight},f=()=>{S(),w(u.value)};return M(()=>e.intensity,i=>{u.value=Math.floor(25*i),f()}),M(()=>e.enabled,i=>{i?(x(),w(u.value)):S()}),J(()=>{se(()=>{x(),e.enabled&&w(u.value)}),window.addEventListener("resize",()=>{x(),f()})}),pe(()=>{S(),window.removeEventListener("resize",x)}),(i,s)=>(b(),_("div",{class:"petal-container",ref_key:"containerRef",ref:o},[(b(!0),_(D,null,K(r.value,(p,g)=>(b(),_("div",{class:"petal",key:g,style:Y({width:`${p.size}px`,height:`${p.size}px`,left:`${p.left}px`,top:`${p.top}px`,opacity:p.opacity,background:`linear-gradient(135deg, hsl(${p.hue}, 100%, 85%), hsl(${p.hue}, 100%, 75%))`,animation:`fall-${p.id} ${p.duration}s linear ${p.delay}s infinite`})},null,4))),128))],512))}}),Ve=R(Re,[["__scopeId","data-v-08072ab2"]]),ze=V({__name:"Snow",props:{enabled:{type:Boolean,default:!0},intensity:{default:1}},setup(n){const e=n,r=y([]),o=y(null),t=y(0),u=y(Math.floor(50*e.intensity)),c=["â„","â…","â†","â€¢","Â·"],d=()=>Math.random().toString(36).substr(2,9),k=()=>{const s=Math.random()*10+8,p=Math.random()*window.innerWidth,g=-30,v=Math.random()*15+20,P=Math.random()*10,N=Math.random()*.7+.3,ee=Math.random()*100-50,re=c[Math.floor(Math.random()*c.length)];return{id:d(),size:s,left:p,top:g,opacity:N,duration:v,delay:P,horizontalMovement:ee,content:re}},w=s=>{const p=document.createElement("style");document.head.appendChild(p);const g=`
  @keyframes fall-${s.id} {
    0% {
      transform: translate(0, 0) rotate(0deg);
      opacity: ${s.opacity};
    }
    25% {
      transform: translate(${s.horizontalMovement*.25}px, ${t.value*.25}px) 
                 rotate(${Math.random()*90}deg);
      opacity: ${s.opacity*.95};
    }
    50% {
      transform: translate(${s.horizontalMovement*.5}px, ${t.value*.5}px) 
                 rotate(${Math.random()*180}deg);
      opacity: ${s.opacity*.9};
    }
    75% {
      transform: translate(${s.horizontalMovement*.75}px, ${t.value*.75}px) 
                 rotate(${Math.random()*270}deg);
      opacity: ${s.opacity*.8};
    }
    100% {
      transform: translate(${s.horizontalMovement}px, ${t.value}px) 
                 rotate(${Math.random()*360}deg);
      opacity: ${s.opacity*.4};;
    }
  }
`;p.innerHTML=g,s.styleSheet=p},S=s=>{for(let p=0;p<s;p++){const g=k();w(g),r.value.push(g)}},x=()=>{r.value.forEach(s=>{s.styleSheet&&s.styleSheet.parentNode&&s.styleSheet.parentNode.removeChild(s.styleSheet)}),r.value=[]},f=()=>{o.value&&o.value.parentElement?t.value=o.value.parentElement.clientHeight:t.value=window.innerHeight},i=()=>{x(),S(u.value)};return M(()=>e.intensity,s=>{u.value=Math.floor(50*s),i()}),M(()=>e.enabled,s=>{s?(f(),S(u.value)):x()}),J(()=>{se(()=>{f(),e.enabled&&S(u.value)}),window.addEventListener("resize",()=>{f(),i()})}),pe(()=>{x(),window.removeEventListener("resize",f)}),(s,p)=>(b(),_("div",{class:"snow-container",ref_key:"containerRef",ref:o},[(b(!0),_(D,null,K(r.value,(g,v)=>(b(),_("div",{class:"snowflake",key:v,style:Y({width:`${g.size}px`,height:`${g.size}px`,left:`${g.left}px`,top:`${g.top}px`,opacity:g.opacity,animation:`fall-${g.id} ${g.duration}s linear ${g.delay}s infinite`})},C(g.content),5))),128))],512))}}),Ue=R(ze,[["__scopeId","data-v-434a360c"]]),De={__name:"GameBackground",setup(n){const e=W(),r=y(null),o=y(),t=y(),u=y(!0),c=y(200),d=y(.4),k=y(["rgb(173, 216, 230)","rgb(176, 224, 230)","rgb(241, 141, 252)","rgb(176, 230, 224)","rgb(173, 230, 216)"]),w=y(!0),S=y(1),x=y(1.5),f=O(()=>({backgroundImage:e.currentBackground?`url(${e.currentBackground})`:"url(@/assets/images/default_bg.jpg)"})),i=s=>{console.log("Starfield ready",s)};return M(()=>e.currentSoundEffect,s=>{o.value&&s&&s!=="None"&&(o.value.src=s,o.value.load(),o.value.play())}),M(()=>e.currentBackgroundMusic,s=>{t.value&&s&&s!=="None"&&(t.value.src=s,t.value.load(),t.value.play())}),(s,p)=>(b(),_(D,null,[a("div",{class:"game-background",style:Y(f.value)},[l(e).currentBackgroundEffect==="StarField"?(b(),j(Ae,{key:0,ref_key:"starfieldRef",ref:r,enabled:u.value,"star-count":c.value,"scroll-speed":d.value,colors:k.value,onReady:i},null,8,["enabled","star-count","scroll-speed","colors"])):L("",!0),l(e).currentBackgroundEffect==="Rain"?(b(),j(Ee,{key:1,enabled:w.value,intensity:S.value},null,8,["enabled","intensity"])):L("",!0),l(e).currentBackgroundEffect==="Sakura"?(b(),j(Ve,{key:2,enabled:!0,intensity:1.5})):L("",!0),l(e).currentBackgroundEffect==="Snow"?(b(),j(Ue,{key:3,intensity:x.value,enabled:!0},null,8,["intensity"])):L("",!0),p[0]||(p[0]=$(" < ",-1))],4),a("audio",{ref_key:"soundEffectPlayer",ref:o},null,512),a("audio",{ref_key:"backgroundMusicPlayer",ref:t,loop:""},null,512)],64))}},Pe=R(De,[["__scopeId","data-v-afef1786"]]),He=["innerHTML"],Fe=V({__name:"Icon",props:{icon:{type:String,default:"character"},size:{type:Number,default:18}},emits:["click"],setup(n,{emit:e}){const r=n,o=O(()=>t[r.icon]),t={character:'<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M18 20a6 6 0 0 0-12 0"/><circle cx="12" cy="10" r="4"/><circle cx="12" cy="12" r="10"/></svg>',text:'<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="21" y1="10" x2="3" y2="10"/><line x1="21" y1="6" x2="3" y2="6"/><line x1="21" y1="14" x2="3" y2="14"/><line x1="21" y1="18" x2="3" y2="18"/></svg>',background:'<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect width="18" height="18" x="3" y="3" rx="2" ry="2"/><circle cx="9" cy="9" r="2"/><path d="m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21"/></svg>',sound:'<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M2 10v3M6 7v9M10 4v15M14 7v9M18 10v3"/></svg>',history:'<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-history-icon lucide-history"><path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"/><path d="M3 3v5h5"/><path d="M12 7v5l4 2"/></svg>',box:'<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect width="20" height="5" x="2" y="4" rx="2"/><path d="M4 9v9a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9"/><path d="M10 13h4"/></svg>',play:'<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-play-icon lucide-play"><path d="M5 5a2 2 0 0 1 3.008-1.728l11.997 6.998a2 2 0 0 1 .003 3.458l-12 7A2 2 0 0 1 5 19z"/></svg>',save:'<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-book-marked-icon lucide-book-marked"><path d="M10 2v8l3-3 3 3V2"/><path d="M4 19.5v-15A2.5 2.5 0 0 1 6.5 2H19a1 1 0 0 1 1 1v18a1 1 0 0 1-1 1H6.5a1 1 0 0 1 0-5H20"/></svg>',advance:'<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="4" x2="4" y1="21" y2="14" /><line x1="4" x2="4" y1="10" y2="3" /><line x1="12" x2="12" y1="21" y2="12" /><line x1="12" x2="12" y1="8" y2="3" /><line x1="20" x2="20" y1="21" y2="16" /><line x1="20"x2="20" y1="12" y2="3" /><line x1="2" x2="6" y1="14" y2="14" /><line x1="10" x2="14" y1="8" y2="8" /><line x1="18" x2="22" y1="16" y2="16" /></svg>',close:'<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>',schedule:'<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-clipboard-list-icon lucide-clipboard-list"><rect width="8" height="4" x="8" y="2" rx="1" ry="1"/><path d="M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2"/><path d="M12 11h4"/><path d="M12 16h4"/><path d="M8 11h.01"/><path d="M8 16h.01"/></svg>',update:'<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-rss-icon lucide-rss"><path d="M4 11a9 9 0 0 1 9 9"/><path d="M4 4a16 16 0 0 1 16 16"/><circle cx="5" cy="19" r="1"/></svg>'};return(u,c)=>(b(),_("span",{innerHTML:o.value,style:Y(`width:${n.size}px, height:${n.size}px`),onClick:c[0]||(c[0]=d=>u.$emit("click"))},null,12,He))}}),we=R(Fe,[["__scopeId","data-v-0f3999fc"]]),Le=["disabled"],je=V({__name:"Button",props:{type:{},disabled:{type:Boolean},icon:{},icon_size:{}},emits:["click"],setup(n,{emit:e}){return(r,o)=>(b(),_("button",{class:F(n.type),disabled:n.disabled,onClick:o[0]||(o[0]=t=>r.$emit("click"))},[n.icon?(b(),j(we,{key:0,icon:n.icon,size:n.icon_size},null,8,["icon","size"])):L("",!0),ae(r.$slots,"default",{},void 0)],10,Le))}}),I=R(je,[["__scopeId","data-v-07752d7f"]]),Ne={name:"GlassInput",inheritAttrs:!1,props:{modelValue:{type:String,default:""}},emits:["update:modelValue"]},Oe={class:"form-group"},Ge=["value"];function We(n,e,r,o,t,u){return b(),_("div",Oe,[a("input",$e({type:"text",class:"form-control",value:r.modelValue,onInput:e[0]||(e[0]=c=>n.$emit("update:modelValue",c.target.value))},n.$attrs),null,16,Ge)])}const qe=R(Ne,[["render",We],["__scopeId","data-v-ea73f387"]]),Ke=["min","max","step","value"],Je=V({__name:"Slider",props:{value:{type:Number,require:!1},min:{type:Number,default:0},max:{type:Number,default:100},step:{type:Number,default:1}},emits:["change","input"],setup(n,{emit:e}){const r=n,o=y(),t=ye();o.value=(r.min+r.max)/2;const u=O(()=>{if(t.default){const d=t.default();if(d&&d[0]&&typeof d[0].children=="string")return d[0].children.split("/")[0]||""}return""}),c=O(()=>{if(t.default){const d=t.default();if(d&&d[0]&&typeof d[0].children=="string")return d[0].children.split("/")[1]||""}return""});return(d,k)=>(b(),_("div",null,[a("span",null,[ae(d.$slots,"left",{},()=>[$(C(u.value),1)])]),H(a("input",{type:"range",min:n.min,max:n.max,step:n.step,value:o.value,onInput:k[0]||(k[0]=w=>d.$emit("input",Number(o.value))),onChange:k[1]||(k[1]=w=>d.$emit("change",Number(o.value))),"onUpdate:modelValue":k[2]||(k[2]=w=>o.value=w)},null,40,Ke),[[de,o.value]]),a("span",null,[ae(d.$slots,"right",{},()=>[$(C(c.value),1)])])]))}}),ue=R(Je,[["__scopeId","data-v-c3230732"]]),Qe={__name:"Text",props:{speed:{type:Number,default:0}},setup(n){const e=n,r=y(),o=ye().default()[0].children;M(()=>e.speed,()=>u(e.speed));let t;const u=c=>{clearInterval(t),r.value="";let d=0;const k=200,S=k-(c-1)/99*(k-10);t=setInterval(()=>{d<o.length?(r.value+=o.charAt(d),d++):clearInterval(t)},S)};return(c,d)=>(b(),_("div",null,[a("p",null,C(r.value),1),d[0]||(d[0]=a("span",null,null,-1))]))}},Ye=R(Qe,[["__scopeId","data-v-79a954ed"]]),Xe=["id","checked"],Ze=["for"],et=V({__name:"Toggle",props:{checked:{type:Boolean,default:!1}},emits:["change"],setup(n,{emit:e}){const r=y(),o=y();return J(()=>{r.value=Math.random().toString(36).substring(2,9)}),(t,u)=>(b(),_("div",null,[H(a("input",{type:"checkbox",id:r.value,checked:n.checked,onChange:u[0]||(u[0]=c=>t.$emit("change",o.value)),"onUpdate:modelValue":u[1]||(u[1]=c=>o.value=c)},null,40,Xe),[[_e,o.value]]),a("label",{for:r.value},[ae(t.$slots,"default",{},void 0)],8,Ze)]))}}),ie=R(et,[["__scopeId","data-v-2c12f9f5"]]);class tt{element;timer=null;abortController;speed;isFinished;onFinishCallback;audioContext;soundBuffers;textBuffers;soundUrls;constructor(e){this.element=e,this.timer=null,this.abortController=null,this.speed=50,this.isFinished=!1,this.onFinishCallback=null,this.audioContext=null,this.soundBuffers=[],this.textBuffers="",this.soundUrls=["../audio_effects/å¯¹è¯.wav"]}async initAudio(){try{this.audioContext=new(window.AudioContext||window.webkitAudioContext),await this.loadSounds()}catch(e){console.warn("éŸ³é¢‘åˆå§‹åŒ–å¤±è´¥:",e);const r=W();r.enableChatEffectSound=!1}}async loadSounds(){if(this.audioContext)try{const e=this.soundUrls.map(async r=>{const t=await(await fetch(r)).arrayBuffer();return this.audioContext.decodeAudioData(t)});this.soundBuffers=await Promise.all(e)}catch(e){console.warn("éŸ³æ•ˆåŠ è½½å¤±è´¥:",e)}}playRandomSound(){if(!W().enableChatEffectSound||!this.audioContext||this.soundBuffers.length===0)return;const r=this.soundBuffers[Math.floor(Math.random()*this.soundBuffers.length)],o=this.audioContext.createBufferSource();o.buffer=r,o.playbackRate.value=1;const t=this.audioContext.createGain();t.gain.value=.8,o.connect(t),t.connect(this.audioContext.destination),o.start()}setSoundEnabled(e){const r=W();r.enableChatEffectSound=e,e&&!this.audioContext&&this.initAudio()}async start(e,r){const o=W();this.stop(),this.isFinished=!1,r!==void 0?this.speed=Number.isInteger(r)?r:Number.parseInt(r.toString(),10)||50:(console.warn("é€Ÿåº¦å€¼æœªå®šä¹‰ï¼Œå°†é‡‡ç”¨é»˜è®¤é€Ÿåº¦ã€‚"),this.speed=50),this.abortController=new AbortController;let t=0;this.textBuffers="",o.enableChatEffectSound&&!this.audioContext&&await this.initAudio();const u=()=>{if(!this.abortController?.signal.aborted)if(t<e.length){this.textBuffers+=e.charAt(t),this.element.value=this.textBuffers,this.element.textContent=this.textBuffers,this.playRandomSound(),t++,this.element.scrollTop=this.element.scrollHeight;const c=this.speed*.8,d=this.speed*.4,k=c+Math.random()*d;this.timer=setTimeout(u,k)}else this.finish()};u()}finish(){this.stop(),this.isFinished=!0,this.element.style.borderRight="none",this.onFinishCallback&&this.onFinishCallback()}stop(){this.timer&&(clearTimeout(this.timer),this.timer=null),this.abortController&&(this.abortController.abort(),this.abortController=null),this.isFinished=!1}checkFinished(){return this.isFinished}onFinish(e){this.onFinishCallback=e}}function at(n){const e=y(null),r=y(!1),o=()=>{n.value&&(e.value=new tt(n.value))},t=async(c,d)=>{e.value||o(),r.value=!0,await e.value?.start(c,d),r.value=!1},u=()=>{e.value?.stop(),r.value=!1};return pe(()=>{u()}),{startTyping:t,stopTyping:u,isTyping:r}}const nt={class:"chatbox-box"},st={class:"chatbox-main"},ot={class:"chatbox-title-part"},lt={class:"chatbox-title"},it={id:"character"},rt={class:"chatbox-subtitle"},ct={id:"character-sub"},ut={class:"chatbox-emotion"},dt={id:"character-emotion"},pt={class:"chatbox-inputbox"},vt=["placeholder","onKeydown","readonly"],ht=["disabled"],ft=V({__name:"GameDialog",emits:["player-continued","dialog-proceed"],setup(n,{expose:e,emit:r}){const o=y(""),t=y(null),u=oe(),c=W(),{startTyping:d}=at(t),k=O(()=>u.currentStatus==="thinking"),w=r,S=()=>{c.toggleSettings(!0),c.setSettingsTab("history")},x=O(()=>{switch(u.currentStatus){case"input":return c.showPlayerHintLine||"åœ¨è¿™é‡Œè¾“å…¥æ¶ˆæ¯...";case"thinking":return u.avatar.think_message;case"responding":case"presenting":return"";default:return"åœ¨è¿™é‡Œè¾“å…¥æ¶ˆæ¯..."}}),f=O(()=>u.currentStatus==="input");M(()=>u.currentStatus,g=>{console.log("æ¸¸æˆçŠ¶æ€å˜ä¸º :",g),g==="thinking"?(u.avatar.emotion="AIæ€è€ƒ",c.showCharacterTitle=u.avatar.character_name,c.showCharacterSubtitle=u.avatar.character_subtitle):g==="input"?(c.showCharacterTitle=u.avatar.user_name,c.showCharacterSubtitle=u.avatar.user_subtitle,c.showCharacterEmotion=""):g==="presenting"&&(c.showCharacterTitle="",c.showCharacterSubtitle="",c.showCharacterEmotion="",c.showCharacterLine="")}),M([()=>c.showCharacterLine,()=>u.currentStatus],([g,v])=>{g&&g!==""&&v==="responding"?(o.value="",d(g,c.typeWriterSpeed)):g===""&&v==="input"&&(o.value="")});function i(){u.currentStatus==="input"?s():u.currentStatus==="responding"&&p(!0)}function s(){const g=o.value;g.trim()&&(g==="/å¼€å§‹å‰§æœ¬"?(u.initializeScript("TODO: ä»å‰§æœ¬é¢æ¿é€‰æ‹©å‰§æœ¬"),u.avatar.show=!1,u.script.isRunning=!0):(u.currentStatus="thinking",u.addToDialogHistory({type:"message",character:u.avatar.user_name,content:g})),Se.sendMessage(g),o.value="")}function p(g){const v=xe.continue();return v||(g&&w("player-continued"),w("dialog-proceed")),v}return e({continueDialog:p}),(g,v)=>(b(),_("div",nt,[a("div",st,[a("div",ot,[a("div",lt,[a("div",it,C(l(c).showCharacterTitle),1)]),a("div",rt,[a("div",ct,C(l(c).showCharacterSubtitle),1)]),a("div",ut,[a("div",dt,C(l(c).showCharacterEmotion),1)]),h(l(I),{type:"nav",icon:"history",title:"",onClick:S})]),v[1]||(v[1]=a("div",{class:"chatbox-line"},null,-1)),a("div",pt,[H(a("textarea",{id:"inputMessage",ref_key:"textareaRef",ref:t,placeholder:x.value,"onUpdate:modelValue":v[0]||(v[0]=P=>o.value=P),onKeydown:ke(fe(i,["exact","prevent"]),["enter"]),readonly:!f.value},null,40,vt),[[de,o.value]]),a("button",{id:"sendButton",disabled:k.value,onClick:i}," â–¼ ",8,ht)])])]))}}),gt={class:"main-box"},mt={id:"menu-panel"},Nn=V({__name:"MainChat",setup(n){const e=W(),r=oe(),o=ge(),t=y(null),u=y(null),c=()=>{e.toggleSettings(!0),e.setSettingsTab("text")},d=()=>{e.autoMode=!e.autoMode},k=async()=>{try{await r.initializeGame(o.client_id,"1"),t.value?t.value.setEmotion("æ­£å¸¸"):console.log("è¿™ä¸ªç»„ä»¶ä¸å­˜åœ¨")}catch(p){console.log(p)}};J(()=>{o.client_id!==""&&k()}),M(()=>r.avatar.character_id,(s,p)=>{s&&s!==p&&(console.log(`Character ID changed to ${s}, re-initializing...`),k())}),M(()=>o.client_id,s=>{s&&k()});let w=null;const S=y(!1),x=()=>{S.value=!1,w&&(clearTimeout(w),w=null)},f=()=>{if(e.autoMode){if(S.value){console.log("çˆ¶ç»„ä»¶ï¼šéŸ³é¢‘ç»“æŸäº†ï¼Œä½†ç”¨æˆ·å·²æ‰‹åŠ¨ç»§ç»­ï¼Œä¸åšä»»ä½•äº‹ã€‚");return}r.currentStatus==="responding"&&(w&&clearTimeout(w),w=setTimeout(()=>{u.value?u.value.continueDialog(!1)&&f():console.error("æ— æ³•æ‰¾åˆ° GameDialog çš„å®ä¾‹ã€‚")},1e3))}},i=()=>{console.log("ç”¨æˆ·ä¸»åŠ¨ç‚¹å‡»äº†"),w&&(clearTimeout(w),w=null,console.log("çˆ¶ç»„ä»¶ï¼šå·²å–æ¶ˆè‡ªåŠ¨ç»§ç»­çš„å®šæ—¶å™¨ã€‚")),S.value?console.log("çˆ¶ç»„ä»¶ï¼šç”¨æˆ·é‡å¤ç‚¹å‡»ï¼Œä½†æ–¹æ³•å·²æ‰§è¡Œè¿‡ï¼Œä¸å†è°ƒç”¨ã€‚"):S.value=!0};return(s,p)=>(b(),_("div",gt,[h(l(Pe)),h(l(Me),{ref_key:"gameAvatarRef",ref:t,onAudioEnded:f},null,512),h(l(ft),{ref_key:"gameDialogRef",ref:u,onPlayerContinued:i,onDialogProceed:x},null,512),a("div",mt,[H(h(l(I),{type:"nav",icon:"play",onClick:d,class:F([{active:l(e).autoMode}])},{default:m(()=>[...p[0]||(p[0]=[a("h3",null,"è‡ªåŠ¨",-1)])]),_:1},8,["class"]),[[q,l(e).showSettings!==!0]]),H(h(l(I),{type:"nav",icon:"text",onClick:c},{default:m(()=>[...p[1]||(p[1]=[a("h3",null,"èœå•",-1)])]),_:1},512),[[q,l(e).showSettings!==!0]])])]))}}),bt=V({__name:"MenuItem",props:{title:{type:String,default:"é»˜è®¤æ ‡é¢˜"},size:{type:String,default:"large",validator:n=>["small","large"].includes(n)}},setup(n){return(e,r)=>(b(),_("section",{class:F(["menu-item",n.size])},[a("div",null,[a("h4",null,C(n.title),1)]),ae(e.$slots,"default",{},void 0)],2))}}),T=R(bt,[["__scopeId","data-v-3d007fbc"]]),yt={},_t={class:"settings-page active"},kt={class:"settings-columns"};function wt(n,e){return b(),_("div",_t,[a("div",kt,[ae(n.$slots,"default",{},void 0)])])}const Z=R(yt,[["render",wt],["__scopeId","data-v-b11651d0"]]),Ct=async n=>{try{return await Q.get("/v1/chat/history/list",{params:n})}catch(e){throw new Error(e.response?.data?.message||"è·å–å­˜æ¡£åˆ—è¡¨å¤±è´¥")}},$t=async n=>{try{await Q.post("/v1/chat/history/create",n)}catch(e){throw new Error(e.response?.data?.detail||"å­˜æ¡£åˆ›å»ºå¤±è´¥")}},St=async n=>{try{return await Q.get("/v1/chat/history/load",{params:n})}catch(e){throw new Error(e.response?.data?.detail||"å­˜æ¡£åŠ è½½å¤±è´¥")}},xt=async n=>{try{await Q.post("/v1/chat/history/save",n)}catch(e){throw new Error(e.response?.data?.detail||"å­˜æ¡£ä¿å­˜å¤±è´¥")}},At=async n=>{try{await Q.post("/v1/chat/history/delete",n)}catch(e){throw new Error(e.response?.data?.detail||"å­˜æ¡£åˆ é™¤å¤±è´¥")}},Bt={class:"new-save-form"},It={class:"save-section"},Mt={class:"save-list-container"},Tt={key:0,class:"status-message"},Et={key:1,class:"status-message error"},Rt={key:2,class:"status-message"},Vt={key:3,class:"save-list"},zt={class:"save-info"},Ut={class:"save-title"},Dt={class:"save-date"},Pt={class:"save-actions"},Ht=["onClick"],Ft=["onClick"],Lt=["onClick"],ne="1",jt=V({__name:"SettingsSave",setup(n){const e=oe(),r=ge(),o=y([]),t=y(""),u=y(!1),c=y(null),d=i=>{const s=new Date(i);return`${s.getFullYear()}.${s.getMonth()+1}.${s.getDate()}`},k=async()=>{u.value=!0,c.value=null;try{const i=await Ct({user_id:ne,page:1,page_size:10});o.value=i.conversations}catch(i){console.error("è·å–å­˜æ¡£åˆ—è¡¨å¤±è´¥:",i),c.value=i.message||"æœªçŸ¥é”™è¯¯"}finally{u.value=!1}},w=async()=>{if(!t.value.trim()){alert("è¯·è¾“å…¥å­˜æ¡£åç§°ï¼");return}try{await $t({user_id:ne,title:t.value.trim()}),t.value="",await k()}catch(i){console.error("åˆ›å»ºå­˜æ¡£å¤±è´¥:",i),alert(`åˆ›å»ºå¤±è´¥: ${i.message}`)}},S=async i=>{try{const s=await St({user_id:ne,conversation_id:i});alert(`å­˜æ¡£ [${i}] è¯»å–æˆåŠŸ!`),e.initializeGame(r.client_id,ne)}catch(s){console.error("è¯»å–å­˜æ¡£å¤±è´¥:",s),alert(`è¯»å–å¤±è´¥: ${s.message}`)}},x=async i=>{try{await xt({user_id:ne,conversation_id:i}),alert(`æˆåŠŸè¦†ç›–å­˜æ¡£ [${i}]!`),await k()}catch(s){console.error("ä¿å­˜æ¸¸æˆå¤±è´¥:",s),alert(`ä¿å­˜å¤±è´¥: ${s.message}`)}},f=async i=>{if(confirm("ç¡®å®šè¦åˆ é™¤è¿™ä¸ªå­˜æ¡£å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ’¤é”€ã€‚"))try{await At({user_id:ne,conversation_id:i}),await k()}catch(s){console.error("åˆ é™¤å­˜æ¡£å¤±è´¥:",s),alert(`åˆ é™¤å¤±è´¥: ${s.message}`)}};return J(()=>{k()}),(i,s)=>(b(),j(l(Z),null,{default:m(()=>[h(l(T),{title:"åˆ›å»ºæ–°å­˜æ¡£"},{default:m(()=>[a("div",Bt,[h(l(qe),{type:"text",modelValue:t.value,"onUpdate:modelValue":s[0]||(s[0]=p=>t.value=p),placeholder:"è¾“å…¥å­˜æ¡£åç§°",onKeyup:ke(w,["enter"])},null,8,["modelValue"]),a("button",{class:"glass-effect action-btn-create",onClick:w}," åˆ›å»º ")])]),_:1}),h(l(T),{title:"å­˜æ¡£åˆ—è¡¨"},{default:m(()=>[a("div",It,[a("div",Mt,[u.value?(b(),_("div",Tt,"åŠ è½½ä¸­...")):c.value?(b(),_("div",Et," åŠ è½½å¤±è´¥: "+C(c.value),1)):o.value.length===0?(b(),_("div",Rt," æš‚æ— å­˜æ¡£è®°å½• ")):(b(),_("div",Vt,[(b(!0),_(D,null,K(o.value,p=>(b(),_("div",{key:p.id,class:"save-card glass-effect"},[a("div",zt,[a("span",Ut,C(p.title||"æœªå‘½åå­˜æ¡£"),1),a("span",Dt,C(d(p.updated_at)),1)]),a("div",Pt,[a("button",{onClick:g=>S(p.id),class:"glass-effect action-btn-load"}," è¯»å– ",8,Ht),a("button",{onClick:g=>x(p.id),class:"action-btn-save glass-effect"}," ä¿å­˜ ",8,Ft),a("button",{onClick:g=>f(p.id),class:"action-btn-delete glass-effect"}," åˆ é™¤ ",8,Lt)])]))),128))]))])])]),_:1})]),_:1}))}}),Nt=R(jt,[["__scopeId","data-v-2e512fee"]]),Ot=V({__name:"SettingsText",setup(n){const e=y(),r=W(),o=c=>{e.value=c,r.typeWriterSpeed=c},t=c=>{console.log(c)},u=c=>{r.enableChatEffectSound=c};return(c,d)=>(b(),j(l(Z),null,{default:m(()=>[h(l(T),{title:"âš¡ æ–‡å­—æ˜¾ç¤ºé€Ÿåº¦"},{default:m(()=>[h(l(ue),{onChange:o},{default:m(()=>[...d[0]||(d[0]=[$("æ…¢/å¿«",-1)])]),_:1})]),_:1}),h(l(T),{title:"ğŸ“ æ˜¾ç¤ºæ–‡å­—æ ·æœ¬"},{default:m(()=>[h(l(Ye),{speed:e.value},{default:m(()=>[...d[1]||(d[1]=[$("Ling Chat: æµ‹è¯•æ–‡æœ¬æ˜¾ç¤ºé€Ÿåº¦",-1)])]),_:1},8,["speed"])]),_:1}),h(l(T),{title:"âœ¨ é¡µé¢åˆ‡æ¢åŠ¨ç”»",size:"small"},{default:m(()=>[h(l(ie),{onChange:t},{default:m(()=>[...d[2]||(d[2]=[$("å¯ç”¨åŠ¨ç”»æ•ˆæœ",-1)])]),_:1})]),_:1}),h(l(T),{title:"ğŸŒ è¯­éŸ³éŸ³æ•ˆå¼€å…³",size:"small"},{default:m(()=>[h(l(ie),{onChange:u},{default:m(()=>[...d[3]||(d[3]=[$("å¯ç”¨æ— vitsæ—¶çš„å¯¹è¯éŸ³æ•ˆ",-1)])]),_:1})]),_:1}),h(l(T),{title:"âœ¨ WebSocketé€šä¿¡çŠ¶æ€",size:"small"},{default:m(()=>[...d[4]||(d[4]=[a("p",null,"âˆš è¿æ¥æ­£å¸¸",-1)])]),_:1}),h(l(T),{title:"âš™ å½“å‰ä½¿ç”¨çš„AIå¤§æ¨¡å‹",size:"small"},{default:m(()=>[...d[5]||(d[5]=[a("p",null,"DeepSeek V3",-1)])]),_:1})]),_:1}))}}),Gt=R(Ot,[["__scopeId","data-v-cac01c53"]]),Wt=async()=>{try{return await Q.get("/v1/chat/back-music/list")}catch(n){throw new Error(n.response?.data?.message||"è·å–éŸ³ä¹åˆ—è¡¨å¤±è´¥")}},qt=async n=>{try{await Q.post("/v1/chat/back-music/upload",n)}catch(e){throw new Error(e.response?.data?.detail||"å­˜æ¡£ä¸Šä¼ å¤±è´¥")}},Kt=async n=>{try{await Q.delete("/v1/chat/back-music/delete",{params:{url:n}})}catch(e){throw new Error(e.response?.data?.detail||"å­˜æ¡£ä¸Šä¼ å¤±è´¥")}},Jt={class:"sound-test"},Qt={class:"music-controls"},Yt={class:"music-name"},Xt={class:"music-list-container"},Zt={key:0,class:"empty-list"},ea=["onClick"],ta={class:"music-item-name"},aa={class:"music-upload"},na=V({__name:"SettingsSound",setup(n){const e=W(),r=y(null),o=y(null),t=y(null),u=y([]),c=y("æœªé€‰æ‹©éŸ³ä¹"),d=y(!1),k=y(null),w=y(null),S=B=>{r.value&&(r.value.volume=B/100)},x=B=>{o.value&&(o.value.volume=B/100)},f=B=>{t.value&&(t.value.volume=B/100)};M(()=>e.backgroundVolume,B=>{t.value&&(t.value.volume=B/100)});const i=()=>{r.value&&(r.value.src="/audio_effects/è§’è‰²éŸ³é‡æµ‹è¯•.wav",r.value.play().catch(B=>console.error("æµ‹è¯•è§’è‰²éŸ³é‡æ’­æ”¾å¤±è´¥:",B)))},s=()=>{o.value&&(o.value.src="/audio_effects/ç–‘é—®.wav",o.value.play().catch(B=>console.error("æµ‹è¯•æ°”æ³¡éŸ³é‡æ’­æ”¾å¤±è´¥:",B)))},p=async()=>{u.value=await Wt()},g=async B=>{if(!B){console.log("musicå¯¹è±¡ä¸å­˜åœ¨");return}if(confirm(`ç¡®å®šè¦åˆ é™¤ã€Š${B.name}ã€‹å—ï¼Ÿ`))try{await Kt(B.url),console.log(`æ­£åœ¨åˆ é™¤éŸ³ä¹: ${B.url}`),alert(`ã€Š${B.name}ã€‹åˆ é™¤æˆåŠŸ`),await p()}catch(A){console.error("åˆ é™¤éŸ³ä¹å¤±è´¥:",A),alert("åˆ é™¤éŸ³ä¹å¤±è´¥")}},v=async()=>{if(!k.value){alert("è¯·å…ˆé€‰æ‹©ä¸€ä¸ªéŸ³ä¹æ–‡ä»¶");return}const B=k.value,A=[".mp3",".wav",".flac",".webm",".weba",".ogg",".m4a"],G=B.name.slice(B.name.lastIndexOf(".")).toLowerCase();if(!A.includes(G)){alert("ä¸æ”¯æŒçš„éŸ³é¢‘æ ¼å¼ã€‚è¯·ä¸Šä¼ : "+A.join(", "));return}const ce=new FormData;ce.append("file",B);try{await qt(ce),console.log(`æ­£åœ¨ä¸Šä¼ æ–‡ä»¶: ${B.name}`),alert("éŸ³ä¹ä¸Šä¼ æˆåŠŸ"),k.value=null,w.value&&(w.value.value=""),await p()}catch(Ce){console.error("ä¸Šä¼ éŸ³ä¹å¤±è´¥:",Ce),alert("éŸ³ä¹ä¸Šä¼ å¤±è´¥")}},P=O(()=>d.value?"â¸ æš‚åœ":"â–¶ æ’­æ”¾"),N=B=>{if(!t.value)return;const A=`/api/v1/chat/back-music/music_file/${encodeURIComponent(B.url)}`;t.value.src=A,t.value.play().catch(G=>console.error("æ’­æ”¾éŸ³ä¹å¤±è´¥:",G)),c.value=B.name,d.value=!0},ee=()=>{t.value&&(d.value?t.value.pause():!t.value.src&&u.value.length>0?N(u.value[0]):t.value.play().catch(B=>console.error("æ¢å¤æ’­æ”¾å¤±è´¥:",B)),d.value=!t.value.paused)},re=()=>{t.value&&(t.value.pause(),t.value.currentTime=0,d.value=!1)},E=()=>{w.value?.click()},z=B=>{const A=B.target;A.files&&A.files.length>0?k.value=A.files[0]:k.value=null},X=()=>{t.value&&(d.value=!t.value.paused)},le=()=>{d.value=!1};return J(()=>{p(),r.value&&(r.value.volume=e.characterVolume/100),o.value&&(o.value.volume=e.bubbleVolume/100),t.value&&(t.value.volume=e.backgroundVolume/100)}),(B,A)=>(b(),j(l(Z),null,{default:m(()=>[h(l(T),{title:"ğŸ‘© è§’è‰²éŸ³é‡",size:"small"},{default:m(()=>[h(l(ue),{modelValue:l(e).characterVolume,"onUpdate:modelValue":A[0]||(A[0]=G=>l(e).characterVolume=G),onChange:S},{default:m(()=>[...A[3]||(A[3]=[$(" å¼±/å¼º ",-1)])]),_:1},8,["modelValue"])]),_:1}),h(l(T),{title:"ğŸ’¬ æ°”æ³¡éŸ³é‡",size:"small"},{default:m(()=>[h(l(ue),{onChange:x,modelValue:l(e).bubbleVolume,"onUpdate:modelValue":A[1]||(A[1]=G=>l(e).bubbleVolume=G)},{default:m(()=>[...A[4]||(A[4]=[$(" å¼±/å¼º ",-1)])]),_:1},8,["modelValue"])]),_:1}),h(l(T),{title:"ğŸ¶ èƒŒæ™¯éŸ³é‡",size:"small"},{default:m(()=>[h(l(ue),{onChange:f,modelValue:l(e).backgroundVolume,"onUpdate:modelValue":A[2]||(A[2]=G=>l(e).backgroundVolume=G)},{default:m(()=>[...A[5]||(A[5]=[$(" å¼±/å¼º ",-1)])]),_:1},8,["modelValue"])]),_:1}),h(l(T),{title:"ğŸ”Š å£°éŸ³æµ‹è¯•",size:"small"},{default:m(()=>[a("div",Jt,[h(l(I),{type:"big",onClick:i},{default:m(()=>[...A[6]||(A[6]=[$("æµ‹è¯•è§’è‰²éŸ³é‡",-1)])]),_:1}),h(l(I),{type:"big",onClick:s},{default:m(()=>[...A[7]||(A[7]=[$("æµ‹è¯•æ°”æ³¡éŸ³é‡",-1)])]),_:1})])]),_:1}),h(l(T),{title:"âš™ èƒŒæ™¯éŸ³ä¹è®¾ç½®"},{default:m(()=>[a("div",Qt,[h(l(I),{type:"big",onClick:ee,class:"left-button"},{default:m(()=>[$(C(P.value),1)]),_:1}),h(l(I),{type:"big",onClick:re,class:"left-button"},{default:m(()=>[...A[8]||(A[8]=[$("â–  åœæ­¢",-1)])]),_:1}),a("span",Yt,"å½“å‰: "+C(c.value),1)]),a("div",Xt,[u.value.length===0?(b(),_("div",Zt," æš‚æ— éŸ³ä¹ï¼Œè¯·ä¸Šä¼  ")):L("",!0),(b(!0),_(D,null,K(u.value,G=>(b(),_("div",{key:G.url,class:"music-item",onClick:ce=>N(G)},[a("div",ta,C(G.name),1),h(l(I),{onClick:ce=>g(G),class:"action-btn-delete glass-effect"},{default:m(()=>[...A[9]||(A[9]=[$("åˆ é™¤",-1)])]),_:1},8,["onClick"])],8,ea))),128))]),a("div",aa,[h(l(I),{type:"big",onClick:E},{default:m(()=>[...A[10]||(A[10]=[$("â• æ·»åŠ éŸ³ä¹",-1)])]),_:1}),a("input",{ref_key:"fileInput",ref:w,type:"file",onChange:z,accept:".mp3,.wav,.flac,.webm,.weba,.ogg,.m4a",style:{display:"none"}},null,544),h(l(I),{type:"big",onClick:v,disabled:!k.value},{default:m(()=>[...A[11]||(A[11]=[$("ç¡®è®¤ä¸Šä¼ ",-1)])]),_:1},8,["disabled"])])]),_:1}),a("audio",{ref_key:"characterTestPlayer",ref:r},null,512),a("audio",{ref_key:"bubbleTestPlayer",ref:o},null,512),a("audio",{ref_key:"backgroundAudioPlayer",ref:t,loop:"",onTimeupdate:X,onEnded:le},null,544)]),_:1}))}}),sa=R(na,[["__scopeId","data-v-74268141"]]),oa={class:"advanced-settings-box"},la={class:"advanced-settings-grid"},ia={key:0,class:"loader"},ra={class:"category-title"},ca=["onClick"],ua={class:"advanced-content"},da={key:0,class:"adv-content-page active"},pa={class:"advanced-settings-container"},va={class:"adv-title"},ha={class:"adv-description"},fa={class:"checkbox-label"},ga=["id","checked","onChange"],ma={class:"description"},ba=["for"],ya={class:"description"},_a=["id","onUpdate:modelValue"],ka=["for"],wa={class:"description"},Ca=["id","onUpdate:modelValue"],$a={class:"save-actions"},Sa={key:1,class:"adv-content-page active"},xa=V({__name:"SettingsAdvance",setup(n){const e=y(!1),r=y({}),o=me({category:null,subcategory:null}),t=me({message:"",color:"var(--success-color)"}),u=y(null),c=y(null),d=O(()=>o.category&&o.subcategory?r.value[o.category]?.subcategories[o.subcategory]:null),k=(s,p)=>o.category===s&&o.subcategory===p,w=(s,p)=>{o.category=s,o.subcategory=p},S=(s,p)=>{s.value=p?"true":"false"},x=async()=>{if(!d.value)return;const s={};d.value.settings.forEach(p=>{s[p.key]=p.value}),e.value=!0,t.message="";try{const p=await fetch("/api/settings/config",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)}),g=await p.json();if(!p.ok)throw new Error(g.detail||"ä¿å­˜å¤±è´¥");t.message=g.message,t.color="var(--success-color)",await f(!1)}catch(p){t.message=`é”™è¯¯: ${p.message}`,t.color="red"}finally{e.value=!1,setTimeout(()=>{t.message=""},5e3)}},f=async(s=!0)=>{e.value=!0;try{const p=await fetch("/api/settings/config");if(!p.ok)throw new Error("æ— æ³•åŠ è½½é…ç½®");if(r.value=await p.json(),s&&Object.keys(r.value).length>0){const g=Object.keys(r.value)[0],v=Object.keys(r.value[g].subcategories)[0];g&&v&&w(g,v)}}catch(p){console.error(p),t.message=`åŠ è½½é…ç½®å¤±è´¥: ${p.message}`,t.color="red"}finally{e.value=!1}},i=()=>{if(!u.value||!c.value)return;const s=u.value.querySelector(".adv-nav-link.active");if(s){const p=s.offsetTop,g=s.offsetHeight;c.value.style.top=`${p}px`,c.value.style.height=`${g}px`}};return M(o,async()=>{await se(),i()},{deep:!0}),J(async()=>{await f(),await se(),i()}),(s,p)=>(b(),j(l(Z),null,{default:m(()=>[a("div",oa,[a("div",la,[e.value?(b(),_("div",ia,[...p[0]||(p[0]=[a("div",{class:"spinner"},null,-1)])])):L("",!0),a("nav",{ref_key:"navContainerRef",ref:u,class:"advanced-nav"},[a("div",{ref_key:"indicatorRef",ref:c,class:"adv-nav-indicator"},null,512),(b(!0),_(D,null,K(r.value,(g,v)=>(b(),_("div",{key:v,class:"adv-nav-category"},[a("span",ra,C(v),1),(b(!0),_(D,null,K(g.subcategories,(P,N)=>(b(),_("a",{key:N,href:"#",class:F(["adv-nav-link",{active:k(v,N.toString())}]),onClick:fe(ee=>w(v,N.toString()),["prevent"])},C(N),11,ca))),128))]))),128))],512),a("main",ua,[d.value?(b(),_("div",da,[a("div",pa,[a("header",null,[a("h2",va,C(o.subcategory),1),a("p",ha,C(d.value.description||`ä¿®æ”¹ ${o.subcategory} çš„ç›¸å…³é…ç½®`),1)]),a("form",{class:"settings-form",onSubmit:fe(x,["prevent"])},[(b(!0),_(D,null,K(d.value.settings,g=>(b(),_("div",{key:g.key,class:"form-group"},[g.type==="bool"?(b(),_(D,{key:0},[a("label",fa,[a("input",{type:"checkbox",id:g.key,checked:g.value.toLowerCase()==="true",onChange:v=>S(g,v.target.checked)},null,40,ga),$(" "+C(g.key),1)]),a("p",ma,C(g.description||""),1)],64)):g.type==="textarea"?(b(),_(D,{key:1},[a("label",{for:g.key},C(g.key),9,ba),a("p",ya,C(g.description||"æ”¯æŒå¤šè¡Œè¾“å…¥"),1),H(a("textarea",{id:g.key,"onUpdate:modelValue":v=>g.value=v,class:"form-control",rows:"8"},null,8,_a),[[de,g.value]])],64)):(b(),_(D,{key:2},[a("label",{for:g.key},C(g.key),9,ka),a("p",wa,C(g.description||""),1),H(a("input",{type:"text",id:g.key,"onUpdate:modelValue":v=>g.value=v,class:"form-control"},null,8,Ca),[[de,g.value]])],64))]))),128))],32),a("div",$a,[a("button",{onClick:x},"ä¿å­˜"),a("p",{style:Y({color:t.color})},C(t.message),5)])])])):!e.value&&!Object.keys(r.value).length?(b(),_("div",Sa,[...p[1]||(p[1]=[a("div",{class:"advanced-settings-container"},[a("header",null,[a("h2",{class:"adv-title"},"åŠ è½½å¤±è´¥"),a("p",{class:"adv-description"},"æ— æ³•åŠ è½½é…ç½®æˆ–é…ç½®ä¸ºç©ºã€‚")])],-1)])])):L("",!0)])])])]),_:1}))}}),Aa=R(xa,[["__scopeId","data-v-04147be7"]]),Ba={class:"history-container"},Ia={key:0,class:"status-message"},Ma={class:"message-item"},Ta={key:0,class:"player-message"},Ea={class:"name"},Ra={class:"content"},Va=["title"],za={class:"name"},Ua={class:"content"},Da={key:0,class:"final-spacer"},Pa=V({__name:"SettingsHistory",setup(n){const e=oe(),r=O(()=>e.dialogHistory),o=y(null);return M(r,()=>{o.value&&(o.value.scrollTop=o.value.scrollHeight)},{flush:"post",deep:!0}),(t,u)=>(b(),j(l(Z),null,{default:m(()=>[h(l(T),{title:"â—ˆ å†å²å¯¹è¯"},{default:m(()=>[a("div",Ba,[r.value.length===0?(b(),_("div",Ia," æš‚æ— å†å²è®°å½•ï¼Œå»å’ŒtaèŠèŠå¤©å­(*^â–½^*) ")):(b(),_("div",{key:1,class:"chat-history-container",ref_key:"chatContainer",ref:o},[(b(!0),_(D,null,K(r.value,(c,d)=>(b(),_(D,{key:c.timestamp||d},[a("div",Ma,[c.type==="message"?(b(),_("div",Ta,[a("span",Ea,C(c.character)+": ",1),a("span",Ra,C(c.content),1)])):c.type==="reply"?(b(),_("div",{key:1,class:"ai-reply",title:`æƒ…ç»ª: ${c.originalTag}`},[a("span",za,C(c.character)+": ",1),a("span",Ua,[$(C(c.content)+" ",1),c.motionText?(b(),_(D,{key:0},[$("("+C(c.motionText)+")",1)],64)):L("",!0)])],8,Va)):L("",!0)]),c.isFinal?(b(),_("div",Da)):L("",!0)],64))),128))],512))])]),_:1})]),_:1}))}}),Ha=R(Pa,[["__scopeId","data-v-039ec3eb"]]),Fa=V({__name:"SettingsSchedule",setup(n){return(e,r)=>(b(),j(l(Z),null,{default:m(()=>[h(l(T),{title:"ä¸»åŠ¨æé†’ï¼ˆè¯·å»é«˜çº§è®¾ç½®-å®éªŒåŠŸèƒ½è®¾ç½®ï¼‰",size:"small"},{default:m(()=>[h(l(ie),null,{default:m(()=>[...r[0]||(r[0]=[$("æ˜¯å¦å¼€å¯æ—¥ç¨‹ä¸»åŠ¨æé†’åŠŸèƒ½",-1)])]),_:1})]),_:1}),h(l(T),{title:"éšæœºèŠå¤©ï¼ˆæ•¬è¯·æœŸå¾…ï¼‰",size:"small"},{default:m(()=>[h(l(ie),null,{default:m(()=>[...r[1]||(r[1]=[$("æ˜¯å¦å¼€å¯éšæœºé—´éš”ä¸»åŠ¨èŠå¤©åŠŸèƒ½",-1)])]),_:1})]),_:1}),h(l(T),{title:"çª¥å±æƒé™ï¼ˆæ•¬è¯·æœŸå¾…ï¼‰",size:"small"},{default:m(()=>[h(l(ie),null,{default:m(()=>[...r[2]||(r[2]=[$("æ˜¯å¦å¼€å¯ä¸»åŠ¨çª¥å±èŠå¤©åŠŸèƒ½",-1)])]),_:1})]),_:1}),h(l(T),{title:"æ—¥ç¨‹åˆ—è¡¨ï¼ˆæ•¬è¯·æœŸå¾…ï¼‰",size:"large"},{default:m(()=>[...r[3]||(r[3]=[$(" æ—¥ç¨‹ç»„ä»¶ ",-1)])]),_:1})]),_:1}))}}),La={class:"character-card"},ja={class:"character-avatar-container"},Na=["src","alt"],Oa={class:"character-content"},Ga={class:"character-title"},Wa={class:"character-description"},qa={class:"character-actions"},Ka=V({__name:"CharacterCard",props:{avatar:{},name:{},info:{}},setup(n){return(e,r)=>(b(),_("div",La,[a("div",ja,[a("img",{src:n.avatar,alt:n.name,class:"character-avatar"},null,8,Na)]),a("div",Oa,[a("h5",Ga,C(n.name),1),a("p",Wa,C(n.info),1),a("div",qa,[ae(e.$slots,"actions",{},void 0)])])]))}}),Ja=R(Ka,[["__scopeId","data-v-1f2f7db6"]]),Qa={};function Ya(n,e){return b(),_("div",null,[ae(n.$slots,"default",{},void 0)])}const Xa=R(Qa,[["render",Ya],["__scopeId","data-v-0e08aff2"]]),Za=async()=>{try{return await Q.get("/v1/chat/character/get_all_characters")}catch(n){throw new Error(n.response?.data?.message||"è·å–è§’è‰²åˆ—è¡¨å¤±è´¥")}},en=async n=>{try{return(await Q.post("/v1/chat/character/select_character",n)).data}catch(e){throw new Error(e.response?.data?.detail||"è§’è‰²é€‰æ‹©å¤±è´¥")}},tn={class:"character-list character-grid"},an=V({__name:"SettingsCharacter",setup(n){const e=y([]),r=y(1),o=oe(),t=ge(),u=async()=>{try{return(await Za()).map(i=>({id:parseInt(i.character_id),title:i.title,info:i.info||"æš‚æ— è§’è‰²æè¿°",avatar:i.avatar_path?`/api/v1/chat/character/character_file/${encodeURIComponent(i.avatar_path)}`:"../pictures/characters/default.png"}))}catch(f){return console.error("è·å–è§’è‰²åˆ—è¡¨å¤±è´¥:",f),[]}},c=async()=>{try{const f=await u();e.value=f}catch(f){console.error("åŠ è½½è§’è‰²å¤±è´¥:",f)}},d=async()=>{await o.initializeGame(t.client_id,"1")},k=async f=>{try{await en({user_id:r.value.toString(),character_id:f.toString()}),d()}catch(i){console.error("åˆ‡æ¢è§’è‰²å¤±è´¥:",i)}},w=async()=>{try{const f=await fetch("/api/v1/chat/character/refresh_characters",{method:"POST",headers:{"Content-Type":"application/json"}});if(!f.ok)throw new Error(`HTTP error! status: ${f.status}`);await f.json(),alert("åˆ·æ–°æˆåŠŸ"),await c()}catch(f){alert("åˆ·æ–°å¤±è´¥"),console.error("åˆ·æ–°å¤±è´¥:",f)}},S=async()=>{try{const f=await fetch("/api/v1/chat/character/open_web");if(!f.ok)throw new Error(`HTTP error! status: ${f.status}`);await f.json()}catch(f){alert("å¯åŠ¨å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨å»lingchatçš„discussionç½‘é¡µ"),console.error("æ‰“å¼€åˆ›æ„å·¥åŠå¤±è´¥:",f)}};function x(f){return o.avatar.character_id===f}return J(()=>{c()}),(f,i)=>(b(),j(l(Z),null,{default:m(()=>[h(l(T),{title:"è§’è‰²åˆ—è¡¨"},{default:m(()=>[h(Xa,null,{default:m(()=>[a("div",tn,[(b(!0),_(D,null,K(e.value,s=>(b(),j(Ja,{key:s.id,avatar:s.avatar,name:s.title,info:s.info},{actions:m(()=>[h(l(I),{type:"select",class:F(["character-select-btn",{selected:x(s.id)}]),onClick:p=>k(s.id)},{default:m(()=>[$(C(x(s.id)?"âˆš é€‰ä¸­":"é€‰æ‹©"),1)]),_:2},1032,["class","onClick"])]),_:2},1032,["avatar","name","info"]))),128))])]),_:1})]),_:1}),h(l(T),{title:"åˆ·æ–°äººç‰©åˆ—è¡¨",size:"small"},{default:m(()=>[h(l(I),{type:"big",onClick:w},{default:m(()=>[...i[0]||(i[0]=[$("ç‚¹æˆ‘åˆ·æ–°~",-1)])]),_:1})]),_:1}),h(l(T),{title:"åˆ›æ„å·¥åŠ",size:"small"},{default:m(()=>[h(l(I),{type:"big",onClick:S},{default:m(()=>[...i[1]||(i[1]=[$("è¿›å…¥åˆ›æ„å·¥åŠ",-1)])]),_:1})]),_:1})]),_:1}))}}),nn=R(an,[["__scopeId","data-v-af509e38"]]),sn=async()=>{try{return await Q.get("/v1/chat/background/list",{})}catch(n){throw console.error("è·å–æ¸¸æˆä¿¡æ¯é”™è¯¯:",n.message),n}},on={class:"background-container"},ln={class:"background-list character-grid"},rn={class:"background-image-container"},cn=["src","alt"],un=["data-title"],dn={class:"effect-list"},pn=V({__name:"SettingsBackground",setup(n){const e=y([]),r=y(""),o=y(null),t=W();J(async()=>{try{await c();const f=localStorage.getItem("selectedBackground");if(f)k(f);else if(e.value.length>0){const i=Math.floor(Math.random()*e.value.length);k(e.value[i].url),console.log("å·²é€‰éšæœºèƒŒæ™¯")}}catch(f){console.error("åŠ è½½èƒŒæ™¯å›¾ç‰‡å¤±è´¥",f)}});async function u(){try{return(await sn()).map(i=>({title:i.title?i.title:"è‰æ³¥é©¬",url:i.url?`/api/v1/chat/background/background_file/${encodeURIComponent(i.url)}`:"../pictures/background/default.png",time:i.time}))}catch(f){return console.error("è·å–èƒŒæ™¯åˆ—è¡¨å¤±è´¥:",f),[]}}async function c(){e.value=await u()}function d(f){return r.value===f}function k(f){r.value=f,t.currentBackground=f,localStorage.setItem("selectedBackground",f)}function w(){o.value&&o.value.click()}async function S(f){const i=f.target,s=i.files?.[0];if(!s)return;const p=s.name,g=p.slice(p.lastIndexOf(".")).toLowerCase(),v=[".jpg",".png",".webp",".bmp",".svg",".tif",".gif"];if(!v.includes(g)){alert("è¯·ä¸Šä¼ æ”¯æŒçš„å›¾ç‰‡æ ¼å¼: "+v.join(", "));return}const P=new FormData;P.append("file",s),P.append("name",p);try{if(!(await fetch("/api/v1/chat/background/upload",{method:"POST",body:P})).ok)throw new Error("ä¸Šä¼ å¤±è´¥");await c(),i&&(i.value="")}catch(N){console.error("ä¸Šä¼ å¤±è´¥",N),alert("ä¸Šä¼ å¤±è´¥ï¼Œè¯·é‡è¯•")}}function x(f){t.currentBackgroundEffect=f}return(f,i)=>(b(),j(l(Z),null,{default:m(()=>[h(l(T),{title:"èƒŒæ™¯é€‰æ‹©"},{default:m(()=>[a("div",on,[a("div",ln,[(b(!0),_(D,null,K(e.value,(s,p)=>(b(),_("div",{key:p,class:F(["background-card",{selected:d(s.url)}])},[a("div",rn,[a("img",{src:s.url,alt:s.title,class:"background-image"},null,8,cn)]),a("div",{class:"background-title","data-title":s.title},[h(l(I),{class:F(["background-select-btn",{selected:d(s.url)}]),onClick:g=>k(s.url)},{default:m(()=>[$(C(d(s.url)?"å·²é€‰ä¸­":"é€‰æ‹©"),1)]),_:2},1032,["class","onClick"])],8,un)],2))),128))]),h(l(I),{type:"big",onClick:w},{default:m(()=>[...i[4]||(i[4]=[$("ä¸Šä¼ è‡ªå®šä¹‰èƒŒæ™¯",-1)])]),_:1}),a("input",{type:"file",ref_key:"uploadInput",ref:o,onChange:S,accept:".jpg,.png,.webp,.bmp,.svg,.tif,.gif",style:{display:"none"}},null,544)])]),_:1}),h(l(T),{title:"ç²’å­é€‰æ‹©",size:"large"},{default:m(()=>[a("div",dn,[h(l(I),{type:"big",onClick:i[0]||(i[0]=s=>x("StarField"))},{default:m(()=>[...i[5]||(i[5]=[$("æ˜Ÿç©º",-1)])]),_:1}),h(l(I),{type:"big",onClick:i[1]||(i[1]=s=>x("Rain"))},{default:m(()=>[...i[6]||(i[6]=[$("é›¨æ°´",-1)])]),_:1}),h(l(I),{type:"big",onClick:i[2]||(i[2]=s=>x("Sakura"))},{default:m(()=>[...i[7]||(i[7]=[$("æ¨±èŠ±",-1)])]),_:1}),h(l(I),{type:"big",onClick:i[3]||(i[3]=s=>x("Snow"))},{default:m(()=>[...i[8]||(i[8]=[$("é›ªæ™¯",-1)])]),_:1})])]),_:1})]),_:1}))}}),vn=R(pn,[["__scopeId","data-v-15da53dd"]]),hn={name:"SettingsUpdate",components:{MenuPage:Z,MenuItem:T,Button:I},data(){return{apiBaseUrl:"http://localhost:5001/api/update",currentVersion:"æœªçŸ¥",updateAvailable:!1,updateStatus:"idle",updateInfo:null,updateChain:[],updateChainInfo:null,errorMessage:"",isChecking:!1,isDownloading:!1,isRollingBack:!1,progress:0,progressMessage:"",showProgress:!1,config:{auto_backup:!0},backendConnected:!1,connectionRetries:0,maxRetries:5,showRollbackDialog:!1,showBackupDialog:!1,statusPolling:null}},mounted(){this.checkBackendConnection()},beforeUnmount(){this.stopStatusPolling()},computed:{isCheckingUpdates(){return this.updateStatus==="checking"},isDownloadingUpdates(){return this.updateStatus==="downloading"},isApplyingUpdates(){return this.updateStatus==="applying"},isRollingBackUpdates(){return this.updateStatus==="rolling_back"},displayVersion(){return this.updateInfo&&(this.updateInfo.target_version||this.updateInfo.version)||"æœªçŸ¥"}},methods:{async checkBackendConnection(){try{const n=await te.get(`${this.apiBaseUrl}/health`,{timeout:5e3});n.data&&n.data.status==="ok"&&(this.backendConnected=!0,this.connectionRetries=0,this.errorMessage="",this.loadAppInfo(),this.loadConfig(),this.startStatusPolling(),console.log("æˆåŠŸè¿æ¥åˆ°æ›´æ–°æœåŠ¡"))}catch(n){console.error("æ— æ³•è¿æ¥åˆ°åç«¯æœåŠ¡:",n),this.backendConnected=!1,this.connectionRetries<this.maxRetries?(this.connectionRetries++,console.log(`é‡è¯•è¿æ¥ (${this.connectionRetries}/${this.maxRetries})...`),setTimeout(()=>this.checkBackendConnection(),2e3)):(this.errorMessage=`æ— æ³•è¿æ¥åˆ°æ›´æ–°æœåŠ¡ã€‚è¯·ç¡®ä¿ update_api.py æ­£åœ¨è¿è¡Œåœ¨ç«¯å£ 5001ã€‚é”™è¯¯: ${n.message}`,this.stopStatusPolling())}},async loadAppInfo(){if(this.backendConnected)try{const n=await te.get(`${this.apiBaseUrl}/info`,{timeout:5e3});n.data&&(this.currentVersion=n.data.current_version||"æœªçŸ¥",this.updateAvailable=n.data.update_available||!1,this.updateChainInfo=n.data.update_chain_info||null)}catch(n){console.error("è·å–åº”ç”¨ä¿¡æ¯å¤±è´¥:",n),this.handleApiError(n,"è·å–åº”ç”¨ä¿¡æ¯")}},async loadConfig(){if(this.backendConnected)try{const n=await te.get(`${this.apiBaseUrl}/config`,{timeout:5e3});n.data&&(this.config.auto_backup=n.data.auto_backup||!0)}catch(n){console.error("è·å–é…ç½®å¤±è´¥:",n),this.handleApiError(n,"è·å–é…ç½®")}},async updateConfig(){if(this.backendConnected)try{await te.post(`${this.apiBaseUrl}/config`,this.config,{timeout:5e3})}catch(n){console.error("æ›´æ–°é…ç½®å¤±è´¥:",n),this.handleApiError(n,"æ›´æ–°é…ç½®")}},startStatusPolling(){this.stopStatusPolling(),this.statusPolling=setInterval(async()=>{await this.getUpdateStatus()},1e3)},stopStatusPolling(){this.statusPolling&&(clearInterval(this.statusPolling),this.statusPolling=null)},async getUpdateStatus(){if(this.backendConnected)try{const n=await te.get(`${this.apiBaseUrl}/status`,{timeout:5e3});if(n.data){const e=n.data;this.updateStatus=e.status||"idle",this.progress=e.progress||0,this.progressMessage=e.message||"",this.isChecking=this.updateStatus==="checking",this.isDownloading=["downloading","applying"].includes(this.updateStatus),this.isRollingBack=this.updateStatus==="rolling_back",e.error?this.errorMessage=e.error:this.updateStatus!=="error"&&(this.errorMessage=""),e.update_info&&(this.updateInfo=e.update_info,this.updateAvailable=!0,e.update_info.update_chain&&e.update_info.update_chain.length>0?this.updateChain=e.update_info.update_chain:this.updateChain=[]),this.showProgress=["checking","downloading","applying","rolling_back"].includes(this.updateStatus),this.updateStatus==="completed"&&setTimeout(()=>{this.loadAppInfo(),this.updateAvailable=!1,this.updateInfo=null,this.updateChain=[]},1e3)}}catch(n){console.error("è·å–æ›´æ–°çŠ¶æ€å¤±è´¥:",n),this.handleApiError(n,"è·å–æ›´æ–°çŠ¶æ€")}},handleApiError(n,e){n.code==="NETWORK_ERROR"||n.message.includes("Network Error")?(this.backendConnected=!1,this.errorMessage="ç½‘ç»œé”™è¯¯: æ— æ³•è¿æ¥åˆ°æ›´æ–°æœåŠ¡ã€‚è¯·ç¡®ä¿ update_api.py æ­£åœ¨è¿è¡Œã€‚",this.stopStatusPolling()):n.response?this.errorMessage=`${e}å¤±è´¥: æœåŠ¡å™¨è¿”å›é”™è¯¯ ${n.response.status}`:n.request?(this.backendConnected=!1,this.errorMessage=`${e}å¤±è´¥: æ— æ³•è¿æ¥åˆ°æœåŠ¡å™¨`,this.stopStatusPolling()):this.errorMessage=`${e}å¤±è´¥: ${n.message}`},async checkForUpdates(){this.errorMessage="";try{const n=await te.post(`${this.apiBaseUrl}/check`,{},{timeout:1e4});n.data&&n.data.success?this.progressMessage="æ­£åœ¨æ£€æŸ¥æ›´æ–°...":this.errorMessage=n.data.error||"æ£€æŸ¥æ›´æ–°å¤±è´¥"}catch(n){console.error("æ£€æŸ¥æ›´æ–°å¤±è´¥:",n),this.handleApiError(n,"æ£€æŸ¥æ›´æ–°")}},async downloadAndApplyUpdate(){this.errorMessage="",this.updateChain&&this.updateChain.length>1?this.showBackupDialog=!0:await this.startUpdate(this.config.auto_backup)},async startUpdate(n){try{const e=await te.post(`${this.apiBaseUrl}/apply`,{backup:n},{timeout:3e4});e.data&&e.data.success?this.progressMessage="å¼€å§‹ä¸‹è½½æ›´æ–°...":this.errorMessage=e.data.error||"å¼€å§‹æ›´æ–°å¤±è´¥"}catch(e){console.error("å¼€å§‹æ›´æ–°å¤±è´¥:",e),this.handleApiError(e,"å¼€å§‹æ›´æ–°")}},confirmUpdateWithBackup(n){this.showBackupDialog=!1,this.startUpdate(n)},cancelUpdate(){this.showBackupDialog=!1},rollbackUpdate(){this.showRollbackDialog=!0},async confirmRollback(){this.showRollbackDialog=!1,this.errorMessage="";try{const n=await te.post(`${this.apiBaseUrl}/rollback`,{},{timeout:3e4});n.data&&n.data.success?this.progressMessage="æ­£åœ¨å›æ»š...":this.errorMessage=n.data.error||"å¼€å§‹å›æ»šå¤±è´¥"}catch(n){console.error("å¼€å§‹å›æ»šå¤±è´¥:",n),this.handleApiError(n,"å¼€å§‹å›æ»š")}},cancelRollback(){this.showRollbackDialog=!1}}},fn={key:0,class:"connection-status error"},gn={key:1,class:"connection-status success"},mn={class:"current-version"},bn={key:0,class:"update-chain-info"},yn={key:1,class:"error-message"},_n={class:"action-buttons"},kn={class:"update-info"},wn={key:0},Cn={key:1},$n={class:"progress-container"},Sn={class:"progress-bar"},xn={class:"progress-text"},An={class:"config-item"},Bn={key:2,class:"dialog-overlay"},In={class:"dialog"},Mn={class:"dialog-actions"},Tn={key:3,class:"dialog-overlay"},En={class:"dialog"},Rn={class:"dialog-actions"};function Vn(n,e,r,o,t,u){const c=ve("Button"),d=ve("MenuItem"),k=ve("MenuPage");return b(),j(k,null,{default:m(()=>[h(d,{title:"ğŸ”— æ›´æ–°æœåŠ¡è¿æ¥çŠ¶æ€",size:"small"},{default:m(()=>[t.backendConnected?(b(),_("div",gn,[...e[7]||(e[7]=[a("p",null,"âœ… å·²è¿æ¥åˆ°æ›´æ–°æœåŠ¡",-1)])])):(b(),_("div",fn,[e[5]||(e[5]=a("p",null,"âš ï¸ æœªè¿æ¥åˆ°æ›´æ–°æœåŠ¡",-1)),e[6]||(e[6]=a("p",null,"è¯·ç¡®ä¿ update_api.py æ­£åœ¨è¿è¡Œåœ¨ç«¯å£ 5001",-1)),h(c,{type:"big",onClick:u.checkBackendConnection},{default:m(()=>[...e[4]||(e[4]=[$("é‡è¯•è¿æ¥",-1)])]),_:1},8,["onClick"])]))]),_:1}),h(d,{title:"ğŸ“‹ å½“å‰ç‰ˆæœ¬ä¿¡æ¯",size:"small"},{default:m(()=>[a("div",mn,[a("p",null,[e[8]||(e[8]=a("strong",null,"å½“å‰ç‰ˆæœ¬:",-1)),$(" "+C(t.currentVersion),1)]),a("p",null,[e[9]||(e[9]=a("strong",null,"æ›´æ–°çŠ¶æ€:",-1)),$(" "+C(t.updateStatus),1)]),t.updateChainInfo&&t.updateChainInfo.update_count>1?(b(),_("p",bn," å‘ç° "+C(t.updateChainInfo.update_count)+" ä¸ªå¾…æ›´æ–°ç‰ˆæœ¬: "+C(t.updateChainInfo.current_version)+" â†’ "+C(t.updateChainInfo.target_version),1)):L("",!0),t.errorMessage?(b(),_("p",yn,C(t.errorMessage),1)):L("",!0)])]),_:1}),h(d,{title:"ğŸ”„ æ›´æ–°æ“ä½œ",size:"large"},{default:m(()=>[a("div",_n,[h(c,{type:"big",onClick:u.checkForUpdates,disabled:!t.backendConnected||t.isChecking||t.isDownloading||t.isRollingBack,class:"left-button"},{default:m(()=>[$(C(t.isChecking?"â³ æ£€æŸ¥ä¸­...":"ğŸ” æ£€æŸ¥æ›´æ–°"),1)]),_:1},8,["onClick","disabled"]),h(c,{type:"big",onClick:u.downloadAndApplyUpdate,disabled:!t.backendConnected||!t.updateAvailable||t.isChecking||t.isDownloading||t.isRollingBack,class:"left-button"},{default:m(()=>[$(C(t.isDownloading?"â³ ä¸‹è½½ä¸­...":"ğŸ“¥ ä¸‹è½½å¹¶åº”ç”¨æ›´æ–°"),1)]),_:1},8,["onClick","disabled"]),h(c,{type:"big",onClick:u.rollbackUpdate,disabled:!t.backendConnected||t.isChecking||t.isDownloading||t.isRollingBack,class:"left-button danger"},{default:m(()=>[$(C(t.isRollingBack?"â³ å›æ»šä¸­...":"â†©ï¸ å›æ»šåˆ°ä¸Šæ¬¡å¤‡ä»½"),1)]),_:1},8,["onClick","disabled"])])]),_:1}),t.updateInfo?(b(),j(d,{key:0,title:"ğŸ†• å‘ç°æ–°ç‰ˆæœ¬",size:"small"},{default:m(()=>[a("div",kn,[t.updateChain&&t.updateChain.length>0?(b(),_("div",wn,[a("p",null,[a("strong",null,"å‘ç° "+C(t.updateChain.length)+" ä¸ªå¾…æ›´æ–°ç‰ˆæœ¬:",1)]),(b(!0),_(D,null,K(t.updateChain,(w,S)=>(b(),_("div",{key:S,class:"update-chain-item"},[a("p",null,[a("strong",null,"ç‰ˆæœ¬ "+C(w.version||"æœªçŸ¥"),1),$(" - "+C(w.changelog||"æ— æ›´æ–°è¯´æ˜"),1)])]))),128))])):(b(),_("div",Cn,[a("p",null,[e[10]||(e[10]=a("strong",null,"ç‰ˆæœ¬:",-1)),$(" "+C(u.displayVersion),1)]),a("p",null,[e[11]||(e[11]=a("strong",null,"æ›´æ–°å†…å®¹:",-1)),$(" "+C(t.updateInfo.changelog||"æ— "),1)])]))])]),_:1})):L("",!0),t.showProgress?(b(),j(d,{key:1,title:"ğŸ“Š æ›´æ–°è¿›åº¦",size:"small"},{default:m(()=>[a("div",$n,[a("div",Sn,[a("div",{class:"progress-fill",style:Y({width:t.progress+"%"})},null,4)]),a("p",xn,C(t.progressMessage),1)])]),_:1})):L("",!0),h(d,{title:"âš™ æ›´æ–°é…ç½®"},{default:m(()=>[a("div",An,[a("label",null,[H(a("input",{type:"checkbox","onUpdate:modelValue":e[0]||(e[0]=w=>t.config.auto_backup=w),onChange:e[1]||(e[1]=(...w)=>u.updateConfig&&u.updateConfig(...w))},null,544),[[_e,t.config.auto_backup]]),e[12]||(e[12]=$(" è‡ªåŠ¨åˆ›å»ºå¤‡ä»½ ",-1))]),e[13]||(e[13]=a("span",{class:"config-help"},"åº”ç”¨æ›´æ–°å‰è‡ªåŠ¨åˆ›å»ºå®Œæ•´å¤‡ä»½",-1))])]),_:1}),t.showRollbackDialog?(b(),_("div",Bn,[a("div",In,[e[16]||(e[16]=a("h3",null,"ç¡®è®¤å›æ»š",-1)),e[17]||(e[17]=a("p",null,"ç¡®è®¤å›æ»šåˆ°ä¸Šæ¬¡å¤‡ä»½å—ï¼Ÿ",-1)),a("div",Mn,[h(c,{type:"big",onClick:u.confirmRollback,class:"danger"},{default:m(()=>[...e[14]||(e[14]=[$("ç¡®è®¤å›æ»š",-1)])]),_:1},8,["onClick"]),h(c,{type:"big",onClick:u.cancelRollback,class:"left-button"},{default:m(()=>[...e[15]||(e[15]=[$("å–æ¶ˆ",-1)])]),_:1},8,["onClick"])])])])):L("",!0),t.showBackupDialog?(b(),_("div",Tn,[a("div",En,[e[21]||(e[21]=a("h3",null,"åˆ›å»ºå¤‡ä»½",-1)),e[22]||(e[22]=a("p",null,"æ˜¯å¦åœ¨åº”ç”¨å‰åˆ›å»ºå…¨é‡å¤‡ä»½ï¼Ÿ",-1)),a("div",Rn,[h(c,{type:"big",onClick:e[2]||(e[2]=w=>u.confirmUpdateWithBackup(!0)),class:"left-button"},{default:m(()=>[...e[18]||(e[18]=[$("æ˜¯",-1)])]),_:1}),h(c,{type:"big",onClick:e[3]||(e[3]=w=>u.confirmUpdateWithBackup(!1)),class:"left-button"},{default:m(()=>[...e[19]||(e[19]=[$("å¦",-1)])]),_:1}),h(c,{type:"big",onClick:u.cancelUpdate,class:"left-button"},{default:m(()=>[...e[20]||(e[20]=[$("å–æ¶ˆ",-1)])]),_:1},8,["onClick"])])])])):L("",!0)]),_:1})}const zn=R(hn,[["render",Vn],["__scopeId","data-v-ee355bc7"]]),Un={class:"nav-container"},Dn=V({__name:"SettingsNav",setup(n){const e=W(),r=y(null),o=y(null),t=y(null),u=y(null),c=y(null),d=y(null),k=y(null),w=y(null),S=y(null),x=y(null),f=(g,v)=>{e.setSettingsTab(g);const P={characterBtn:o,textBtn:t,backgroundBtn:u,soundBtn:c,historyBtn:d,saveBtn:k,advanceBtn:w,scheduleBtn:S,updateBtn:x}[v];P?.value?.$el&&i(P.value.$el)},i=g=>{!r.value||!g||(r.value.style.left=`${g.offsetLeft}px`,r.value.style.width=`${g.offsetWidth}px`)},s=()=>{const g=e.currentSettingsTab;let v=null;switch(g){case"character":v=o.value;break;case"text":v=t.value;break;case"background":v=u.value;break;case"sound":v=c.value;break;case"history":v=d.value;break;case"save":v=k.value;break;case"advance":v=w.value;break;case"schedule":v=S.value;break;case"update":v=x.value;break}v?.$el&&i(v.$el)};J(()=>{s()}),M(()=>e.currentSettingsTab,()=>{s()});const p=()=>{e.toggleSettings(!1)};return(g,v)=>(b(),_("div",Un,[v[18]||(v[18]=a("img",{src:Be,alt:"Logo",class:"settings-logo"},null,-1)),a("nav",null,[a("div",{ref_key:"indicator",ref:r,class:"nav-indicator"},null,512),h(l(I),{ref_key:"characterBtn",ref:o,type:"nav",icon:"character",onClick:v[0]||(v[0]=()=>f("character","characterBtn")),class:F({active:l(e).currentSettingsTab==="character"})},{default:m(()=>[...v[9]||(v[9]=[a("p",{class:"button-text"},"è§’è‰²",-1)])]),_:1},8,["class"]),h(l(I),{ref_key:"textBtn",ref:t,type:"nav",icon:"text",onClick:v[1]||(v[1]=()=>f("text","textBtn")),class:F({active:l(e).currentSettingsTab==="text"})},{default:m(()=>[...v[10]||(v[10]=[a("p",{class:"button-text"},"é€šç”¨",-1)])]),_:1},8,["class"]),h(l(I),{ref_key:"backgroundBtn",ref:u,type:"nav",icon:"background",onClick:v[2]||(v[2]=()=>f("background","backgroundBtn")),class:F({active:l(e).currentSettingsTab==="background"})},{default:m(()=>[...v[11]||(v[11]=[a("p",{class:"button-text"},"èƒŒæ™¯",-1)])]),_:1},8,["class"]),h(l(I),{ref_key:"soundBtn",ref:c,type:"nav",icon:"sound",onClick:v[3]||(v[3]=()=>f("sound","soundBtn")),class:F({active:l(e).currentSettingsTab==="sound"})},{default:m(()=>[...v[12]||(v[12]=[a("p",{class:"button-text"},"å£°éŸ³",-1)])]),_:1},8,["class"]),h(l(I),{ref_key:"historyBtn",ref:d,type:"nav",icon:"history",onClick:v[4]||(v[4]=()=>f("history","historyBtn")),class:F({active:l(e).currentSettingsTab==="history"})},{default:m(()=>[...v[13]||(v[13]=[a("p",{class:"button-text"},"å¯¹è¯å†å²",-1)])]),_:1},8,["class"]),h(l(I),{ref_key:"saveBtn",ref:k,type:"nav",icon:"save",onClick:v[5]||(v[5]=()=>f("save","saveBtn")),class:F({active:l(e).currentSettingsTab==="save"})},{default:m(()=>[...v[14]||(v[14]=[a("p",{class:"button-text"},"å­˜æ¡£",-1)])]),_:1},8,["class"]),h(l(I),{ref_key:"scheduleBtn",ref:S,type:"nav",icon:"schedule",onClick:v[6]||(v[6]=()=>f("schedule","scheduleBtn")),class:F({active:l(e).currentSettingsTab==="schedule"})},{default:m(()=>[...v[15]||(v[15]=[a("p",{class:"button-text"},"æ—¥ç¨‹",-1)])]),_:1},8,["class"]),h(l(I),{ref_key:"advanceBtn",ref:w,type:"nav",icon:"advance",onClick:v[7]||(v[7]=()=>f("advance","advanceBtn")),class:F({active:l(e).currentSettingsTab==="advance"})},{default:m(()=>[...v[16]||(v[16]=[a("p",{class:"button-text"},"é«˜çº§è®¾ç½®",-1)])]),_:1},8,["class"]),h(l(I),{ref:"updateBth",type:"nav",icon:"update",onClick:v[8]||(v[8]=()=>f("update","updateBth")),class:F({active:l(e).currentSettingsTab==="update"})},{default:m(()=>[...v[17]||(v[17]=[a("p",{class:"button-text"},"æ£€æŸ¥æ›´æ–°",-1)])]),_:1},8,["class"])]),h(we,{icon:"close",class:"close-button",size:40,onClick:p})]))}}),Pn={class:"settings-panel"},Hn={class:"header"},Fn={class:"container"},On=V({__name:"SettingsPanel",setup(n){const e=W(),r=y(!1),o=y(0);return M(()=>e.showSettings,t=>{t?(r.value=!0,setTimeout(()=>{o.value=1},10)):(o.value=0,setTimeout(()=>{r.value=!1},100))},{immediate:!0}),(t,u)=>(b(),_(D,null,[r.value?(b(),_("div",{key:0,class:"blur-overlay",style:Y({opacity:o.value})},null,4)):L("",!0),H(a("div",Pn,[a("div",Hn,[h(Dn)]),a("div",Fn,[H(h(l(Nt),null,null,512),[[q,l(e).currentSettingsTab==="save"]]),H(h(l(Gt),null,null,512),[[q,l(e).currentSettingsTab==="text"]]),H(h(l(sa),null,null,512),[[q,l(e).currentSettingsTab==="sound"]]),H(h(l(Aa),null,null,512),[[q,l(e).currentSettingsTab==="advance"]]),H(h(l(Ha),null,null,512),[[q,l(e).currentSettingsTab==="history"]]),H(h(l(Fa),null,null,512),[[q,l(e).currentSettingsTab==="schedule"]]),H(h(l(nn),null,null,512),[[q,l(e).currentSettingsTab==="character"]]),H(h(l(vn),null,null,512),[[q,l(e).currentSettingsTab==="background"]]),H(h(l(zn),null,null,512),[[q,l(e).currentSettingsTab==="update"]])])],512),[[q,l(e).showSettings]])],64))}});export{Nn as _,On as a};
